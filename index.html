<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Word2Vec Embeddings â€” Interactive Demo</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.27.0/plotly.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:ital,wght@0,300;0,400;0,500;1,300&family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,700;1,9..144,300&display=swap" rel="stylesheet"/>
<style>
  :root {
    --bg: #070b14;
    --surface: #0d1424;
    --surface2: #111d33;
    --border: #1e2f4a;
    --accent: #4f9cf9;
    --accent2: #7c3aed;
    --accent3: #10b981;
    --accent4: #f59e0b;
    --text: #e2e8f0;
    --muted: #64748b;
    --danger: #ef4444;
    --glow: rgba(79,156,249,0.15);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed; inset: 0;
    background-image:
      radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,0.4) 0%, transparent 100%),
      radial-gradient(1px 1px at 30% 60%, rgba(255,255,255,0.3) 0%, transparent 100%),
      radial-gradient(1px 1px at 50% 10%, rgba(255,255,255,0.2) 0%, transparent 100%),
      radial-gradient(1px 1px at 70% 80%, rgba(255,255,255,0.4) 0%, transparent 100%),
      radial-gradient(1px 1px at 90% 35%, rgba(255,255,255,0.3) 0%, transparent 100%),
      radial-gradient(1px 1px at 25% 40%, rgba(255,255,255,0.25) 0%, transparent 100%),
      radial-gradient(1px 1px at 60% 90%, rgba(255,255,255,0.2) 0%, transparent 100%),
      radial-gradient(1px 1px at 80% 15%, rgba(255,255,255,0.35) 0%, transparent 100%);
    pointer-events: none; z-index: 0;
  }

  /* â”€â”€ EPOCH BANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .epoch-banner {
    position: sticky; top: 0; z-index: 200;
    background: rgba(7,11,20,0.97);
    backdrop-filter: blur(14px);
    border-bottom: 1px solid var(--border);
    padding: 10px 40px;
    display: flex;
    align-items: center;
    gap: 16px;
    flex-wrap: wrap;
  }

  .epoch-label {
    font-size: 10px;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--muted);
    white-space: nowrap;
  }

  .epoch-btns {
    display: flex;
    gap: 0;
    border: 1px solid var(--border);
    border-radius: 3px;
    overflow: hidden;
  }

  .epoch-btn {
    padding: 7px 20px;
    font-family: 'DM Mono', monospace;
    font-size: 12px;
    letter-spacing: 0.08em;
    background: transparent;
    color: var(--muted);
    border: none;
    border-right: 1px solid var(--border);
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .epoch-btn:last-child { border-right: none; }
  .epoch-btn:hover { background: var(--surface2); color: var(--text); }
  .epoch-btn.active {
    background: var(--accent);
    color: #000;
    font-weight: 500;
  }

  .epoch-status {
    font-size: 11px;
    color: var(--muted);
    display: flex;
    align-items: center;
    gap: 8px;
    margin-left: auto;
  }

  .epoch-pill {
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 10px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    background: rgba(79,156,249,0.12);
    border: 1px solid var(--accent);
    color: var(--accent);
  }

  /* learning progress bar */
  .learning-bar-wrap {
    flex: 1;
    min-width: 120px;
    max-width: 200px;
    height: 3px;
    background: var(--border);
    border-radius: 2px;
    overflow: hidden;
  }

  .learning-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--accent2), var(--accent));
    border-radius: 2px;
    transition: width 0.6s cubic-bezier(0.34,1.56,0.64,1);
  }

  /* loading overlay */
  .loading-overlay {
    position: fixed; inset: 0;
    background: rgba(7,11,20,0.88);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    gap: 16px;
    transition: opacity 0.3s;
  }

  .loading-overlay.hidden { opacity: 0; pointer-events: none; }

  .spinner {
    width: 36px; height: 36px;
    border: 3px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  .loading-msg {
    font-size: 12px;
    color: var(--muted);
    letter-spacing: 0.1em;
  }

  /* error state */
  .error-banner {
    background: rgba(239,68,68,0.08);
    border: 1px solid var(--danger);
    border-radius: 4px;
    padding: 20px 24px;
    font-size: 13px;
    color: var(--danger);
    line-height: 1.8;
    margin: 20px 0;
    display: none;
  }

  /* â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .hero {
    position: relative; z-index: 1;
    padding: 50px 40px 36px;
    text-align: center;
    border-bottom: 1px solid var(--border);
    background: linear-gradient(180deg, rgba(79,156,249,0.04) 0%, transparent 100%);
  }

  .hero-tag {
    display: inline-block;
    font-size: 10px; letter-spacing: 0.25em; text-transform: uppercase;
    color: var(--accent); border: 1px solid var(--accent);
    padding: 4px 12px; border-radius: 2px; margin-bottom: 18px;
    animation: fadeUp 0.5s ease forwards 0.1s; opacity: 0;
  }

  h1 {
    font-family: 'Fraunces', serif;
    font-size: clamp(1.8rem, 4.5vw, 3.2rem);
    font-weight: 700; line-height: 1.1; letter-spacing: -0.02em;
    margin-bottom: 14px;
    animation: fadeUp 0.5s ease forwards 0.3s; opacity: 0;
  }

  h1 em { font-style: italic; color: var(--accent); }

  .hero-sub {
    font-size: 12px; color: var(--muted);
    max-width: 540px; margin: 0 auto 24px; line-height: 1.8;
    animation: fadeUp 0.5s ease forwards 0.5s; opacity: 0;
  }

  .pipeline {
    display: flex; align-items: center; justify-content: center;
    gap: 0; flex-wrap: wrap;
    animation: fadeUp 0.5s ease forwards 0.7s; opacity: 0;
  }

  .pipe-step {
    font-size: 9px; letter-spacing: 0.12em; text-transform: uppercase;
    color: var(--muted); padding: 5px 12px;
    border: 1px solid var(--border); background: var(--surface);
    white-space: nowrap;
  }

  .pipe-step.active { color: var(--accent); border-color: var(--accent); background: rgba(79,156,249,0.08); }
  .pipe-arrow { color: var(--border); font-size: 13px; padding: 0 3px; }

  /* â”€â”€ NAV TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .tabs {
    display: flex; gap: 0; padding: 0 40px;
    border-bottom: 1px solid var(--border);
    background: rgba(7,11,20,0.95);
    backdrop-filter: blur(12px);
    z-index: 100; position: relative;
    overflow-x: auto;
  }

  .tab {
    padding: 15px 22px; font-size: 10px; letter-spacing: 0.12em;
    text-transform: uppercase; color: var(--muted);
    cursor: pointer; border-bottom: 2px solid transparent;
    transition: all 0.2s; white-space: nowrap;
  }

  .tab:hover { color: var(--text); }
  .tab.active { color: var(--accent); border-bottom-color: var(--accent); }

  /* â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .main {
    position: relative; z-index: 1;
    max-width: 1200px; margin: 0 auto;
    padding: 36px 40px 80px;
  }

  .panel { display: none; }
  .panel.active { display: block; animation: fadeIn 0.3s ease; }

  @keyframes fadeIn  { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
  @keyframes fadeUp  { from { opacity:0; transform:translateY(16px); } to { opacity:1; transform:translateY(0); } }

  /* â”€â”€ CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 4px; padding: 26px; margin-bottom: 18px;
    position: relative; overflow: hidden;
  }

  .card::before {
    content: ''; position: absolute; top:0; left:0; right:0; height:1px;
    background: linear-gradient(90deg, transparent, var(--accent), transparent);
    opacity: 0.35;
  }

  .card-title {
    font-size: 10px; letter-spacing: 0.2em; text-transform: uppercase;
    color: var(--accent); margin-bottom: 18px;
    display: flex; align-items: center; gap: 8px;
  }

  .card-title::after { content:''; flex:1; height:1px; background:var(--border); }

  /* â”€â”€ EPOCH COMPARE BADGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .compare-badge {
    display: inline-flex; align-items: center; gap: 6px;
    font-size: 10px; letter-spacing: 0.1em; text-transform: uppercase;
    padding: 3px 10px; border-radius: 2px;
    border: 1px solid var(--border); color: var(--muted);
    margin-right: 6px; margin-bottom: 6px;
  }

  .compare-dot { width: 8px; height: 8px; border-radius: 50%; }

  /* â”€â”€ INPUTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .input-group {
    display: flex; gap: 10px; margin-bottom: 14px; flex-wrap: wrap;
  }

  .input-wrap { flex: 1; min-width: 130px; }

  .input-label {
    font-size: 9px; letter-spacing: 0.15em; text-transform: uppercase;
    color: var(--muted); margin-bottom: 5px; display: block;
  }

  input[type="text"] {
    width: 100%;
    background: var(--bg); border: 1px solid var(--border);
    color: var(--text); padding: 9px 13px;
    font-family: 'DM Mono', monospace; font-size: 13px;
    border-radius: 2px; outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  input[type="text"]:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--glow);
  }

  input::placeholder { color: var(--muted); }

  .btn {
    background: var(--accent); color: #000;
    border: none; padding: 9px 20px;
    font-family: 'DM Mono', monospace; font-size: 11px;
    letter-spacing: 0.1em; text-transform: uppercase;
    cursor: pointer; border-radius: 2px; transition: all 0.2s;
    font-weight: 500; align-self: flex-end; white-space: nowrap;
  }

  .btn:hover { background: #7ab8ff; transform: translateY(-1px); box-shadow: 0 4px 20px rgba(79,156,249,0.4); }
  .btn:active { transform: translateY(0); }

  .suggest-row {
    display: flex; gap: 6px; flex-wrap: wrap; margin-top: 10px;
  }

  .suggest-btn {
    font-size: 10px; padding: 3px 9px;
    border: 1px solid var(--border); background: transparent;
    color: var(--muted); font-family: 'DM Mono', monospace;
    cursor: pointer; border-radius: 2px; transition: all 0.15s;
  }

  .suggest-btn:hover { color: var(--accent); border-color: var(--accent); }

  .error-msg { color: var(--danger); font-size: 11px; margin-top: 8px; }

  /* â”€â”€ SCATTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #scatter-plot {
    width: 100%; height: 540px;
    background: var(--bg); border: 1px solid var(--border);
    border-radius: 2px;
  }

  .legend { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 14px; font-size: 11px; }

  .legend-item {
    display: flex; align-items: center; gap: 6px;
    cursor: pointer; padding: 4px 9px;
    border: 1px solid var(--border); border-radius: 2px; transition: all 0.15s;
  }

  .legend-item:hover { border-color: var(--accent); }
  .legend-item.active { border-color: var(--accent); background: rgba(79,156,249,0.06); }
  .legend-dot { width: 9px; height: 9px; border-radius: 50%; }

  .info-row {
    display: flex; gap: 18px; flex-wrap: wrap; margin-bottom: 20px;
  }

  .info-stat {
    font-size: 10px; color: var(--muted);
    display: flex; align-items: center; gap: 5px;
  }

  .info-stat span { color: var(--accent); font-weight: 500; }

  /* â”€â”€ SIMILARITY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .two-col {
    display: grid; grid-template-columns: 1fr 1fr; gap: 18px;
  }

  .score-large {
    font-family: 'Fraunces', serif; font-size: 2.8rem;
    font-weight: 700; letter-spacing: -0.02em;
  }

  .score-label {
    font-size: 10px; letter-spacing: 0.15em; text-transform: uppercase; color: var(--muted);
  }

  .score-bar-wrap {
    width: 100%; height: 4px; background: var(--border);
    border-radius: 2px; margin: 10px 0 7px; overflow: hidden;
  }

  .score-bar { height: 100%; border-radius: 2px; transition: width 0.8s cubic-bezier(0.34,1.56,0.64,1); }

  /* epoch comparison row in similarity */
  .epoch-compare-row {
    display: flex; flex-direction: column; gap: 8px; margin-top: 16px;
  }

  .epoch-compare-item {
    display: flex; align-items: center; gap: 10px; font-size: 12px;
  }

  .ecl { width: 60px; font-size: 10px; color: var(--muted); flex-shrink: 0; }
  .ecbar-wrap { flex: 1; height: 3px; background: var(--border); border-radius: 2px; overflow: hidden; }
  .ecbar { height: 100%; border-radius: 2px; transition: width 0.8s ease; }
  .ecval { width: 50px; text-align: right; font-size: 11px; color: var(--muted); flex-shrink: 0; }

  /* â”€â”€ NEIGHBORS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  /* â”€â”€ ANALOGY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .equation {
    font-family: 'Fraunces', serif; font-size: 1.3rem;
    display: flex; align-items: center; gap: 10px;
    flex-wrap: wrap; margin: 14px 0;
  }

  .eq-word {
    padding: 4px 14px; border-radius: 2px;
    font-style: italic;
  }

  .eq-op { color: var(--muted); font-size: 1.1rem; font-style: normal; font-family: 'DM Mono', monospace; }

  /* â”€â”€ CONCEPTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .concept-grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));
    gap: 14px; margin-bottom: 18px;
  }

  .concept-card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 4px; padding: 22px;
  }

  .concept-icon { font-size: 1.5rem; margin-bottom: 10px; }
  .concept-title { font-family: 'Fraunces', serif; font-size: 1.05rem; margin-bottom: 7px; }
  .concept-desc { font-size: 11px; color: var(--muted); line-height: 1.75; }

  .formula-box {
    background: var(--bg); border: 1px solid var(--border);
    border-left: 3px solid var(--accent2);
    padding: 12px 16px; font-size: 11px; line-height: 1.9;
    margin: 10px 0; border-radius: 0 2px 2px 0;
  }

  /* â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .footer {
    text-align: center; padding: 28px;
    font-size: 11px; color: var(--muted);
    border-top: 1px solid var(--border);
    position: relative; z-index: 1;
  }

  .footer a { color: var(--accent); text-decoration: none; }

  @media (max-width: 700px) {
    .two-col { grid-template-columns: 1fr; }
    .tabs, .epoch-banner { padding: 0 16px; }
    .main { padding: 20px 16px 60px; }
    .hero { padding: 36px 16px 28px; }
    .equation { font-size: 1rem; }
  }
</style>
</head>
<body>

<!-- Loading overlay -->
<div class="loading-overlay" id="loading-overlay">
  <div class="spinner"></div>
  <div class="loading-msg" id="loading-msg">Loading embeddingsâ€¦</div>
</div>

<!-- Hero -->
<div class="hero">
  <div class="hero-tag">Word2Vec Â· Skip-Gram Â· Negative Sampling Â· WikiText-2</div>
  <h1>Words as <em>Vectors</em> in Space</h1>
  <p class="hero-sub">
    Watch how embeddings evolve across training epochs â€” from random noise to
    meaningful semantic structure. Switch epochs above to compare.
  </p>
  <div class="pipeline">
    <div class="pipe-step active">Raw Text</div><div class="pipe-arrow">â†’</div>
    <div class="pipe-step active">Tokenize</div><div class="pipe-arrow">â†’</div>
    <div class="pipe-step active">Subsample</div><div class="pipe-arrow">â†’</div>
    <div class="pipe-step active">Skip-Gram</div><div class="pipe-arrow">â†’</div>
    <div class="pipe-step active">Neg. Sampling</div><div class="pipe-arrow">â†’</div>
    <div class="pipe-step active">Embeddings</div>
  </div>
</div>

<!-- Epoch switcher (sticky) -->
<div class="epoch-banner">
  <div class="epoch-label">Training Epoch</div>
  <div class="epoch-btns">
    <button class="epoch-btn" data-epoch="2"  onclick="switchEpoch(2)">Epoch 2</button>
    <button class="epoch-btn" data-epoch="5"  onclick="switchEpoch(5)">Epoch 5</button>
    <button class="epoch-btn active" data-epoch="10" onclick="switchEpoch(10)">Epoch 10</button>
  </div>
  <div class="learning-bar-wrap">
    <div class="learning-bar" id="learning-bar" style="width:100%"></div>
  </div>
  <div class="epoch-status">
    <div class="epoch-pill" id="epoch-pill">Epoch 10</div>
    <span id="vocab-info" style="font-size:10px;">â€” words loaded</span>
  </div>
</div>

<!-- Nav tabs -->
<div class="tabs">
  <div class="tab active" onclick="switchTab('explore')">ğŸ—º Explore Space</div>
  <div class="tab" onclick="switchTab('similarity')">â‰ˆ Similarity</div>
  <div class="tab" onclick="switchTab('neighbors')">â¬¡ Neighbors</div>
  <div class="tab" onclick="switchTab('analogy')">âŠ• Analogy</div>
  <div class="tab" onclick="switchTab('concepts')">ğŸ“ How It Works</div>
</div>

<div class="main">

  <!-- Error banner (shown if JSON files not found) -->
  <div class="error-banner" id="error-banner">
    âš  Could not load <code id="missing-file"></code>.<br/>
    Make sure all three JSON files are in the same folder as this HTML file:<br/>
    <code>embeddings_epoch2.json</code> &nbsp;Â·&nbsp;
    <code>embeddings_epoch5.json</code> &nbsp;Â·&nbsp;
    <code>embeddings_epoch10.json</code><br/><br/>
    Run <strong>export_embeddings.py</strong> in your notebook to generate them.
    Meanwhile the demo runs with <em>mock embeddings</em>.
  </div>

  <!-- PANEL: SCATTER -->
  <div class="panel active" id="panel-explore">
    <div class="card">
      <div class="card-title">2D Embedding Space Â· PCA Projection</div>
      <div class="info-row">
        <div class="info-stat">Vocabulary: <span id="stat-vocab">â€”</span></div>
        <div class="info-stat">Embed dim: <span id="stat-dim">â€”</span></div>
        <div class="info-stat">PCA var: <span id="stat-pca">â€”</span></div>
        <div class="info-stat">Dataset: <span>WikiText-2</span></div>
        <div class="info-stat">Method: <span>Skip-Gram + NS</span></div>
      </div>
      <div class="legend" id="legend"></div>
      <div id="scatter-plot"></div>
      <p style="font-size:11px; color:var(--muted); margin-top:11px;">
        ğŸ’¡ Switch epochs above to watch clusters form. Hover a word for its label.
        Early epochs look scattered â€” later epochs show tight semantic groupings.
      </p>
    </div>
  </div>

  <!-- PANEL: SIMILARITY -->
  <div class="panel" id="panel-similarity">
    <div class="two-col">
      <div>
        <div class="card">
          <div class="card-title">Cosine Similarity</div>
          <p style="font-size:11px; color:var(--muted); margin-bottom:16px; line-height:1.8;">
            Cosine similarity measures the angle between two embedding vectors.
            <strong>1.0</strong> = same direction, <strong>0</strong> = orthogonal, <strong>âˆ’1</strong> = opposite.
            Watch how scores change across epochs as the model learns.
          </p>
          <div class="input-group">
            <div class="input-wrap">
              <label class="input-label">Word A</label>
              <input type="text" id="sim-word1" placeholder="king" value="king"/>
            </div>
            <div class="input-wrap">
              <label class="input-label">Word B</label>
              <input type="text" id="sim-word2" placeholder="queen" value="queen"/>
            </div>
            <button class="btn" onclick="computeSimilarity()">Compute</button>
          </div>
          <div class="suggest-row">
            <span style="font-size:9px;color:var(--muted);letter-spacing:0.1em;text-transform:uppercase;margin-right:4px;">Try:</span>
            <button class="suggest-btn" onclick="setSim('king','queen')">king/queen</button>
            <button class="suggest-btn" onclick="setSim('music','album')">music/album</button>
            <button class="suggest-btn" onclick="setSim('dog','cat')">dog/cat</button>
            <button class="suggest-btn" onclick="setSim('war','battle')">war/battle</button>
            <button class="suggest-btn" onclick="setSim('king','guitar')">king/guitar</button>
          </div>
          <div id="sim-error" class="error-msg"></div>
        </div>

        <div class="card">
          <div class="card-title">Current Epoch Result</div>
          <div id="sim-result">
            <p style="color:var(--muted); font-size:12px;">Enter two words above and click Compute.</p>
          </div>
        </div>
      </div>

      <div>
        <div class="card" style="margin-bottom:18px;">
          <div class="card-title">Across All Epochs</div>
          <p style="font-size:11px; color:var(--muted); margin-bottom:14px; line-height:1.7;">
            How does similarity for the same word pair evolve as training progresses?
          </p>
          <div id="epoch-compare-result">
            <p style="color:var(--muted); font-size:12px;">Compute a similarity above to see the comparison.</p>
          </div>
        </div>

        <div class="card">
          <div class="card-title">Score Guide</div>
          <div style="font-size:11px; color:var(--muted); line-height:1.9; display:flex; flex-direction:column; gap:8px;">
            <div style="display:flex; align-items:center; gap:10px;">
              <div style="width:40px; height:3px; background:#10b981; border-radius:2px;"></div>
              <span>0.7 â€“ 1.0 â†’ Strongly related</span>
            </div>
            <div style="display:flex; align-items:center; gap:10px;">
              <div style="width:40px; height:3px; background:#4f9cf9; border-radius:2px;"></div>
              <span>0.3 â€“ 0.7 â†’ Moderately related</span>
            </div>
            <div style="display:flex; align-items:center; gap:10px;">
              <div style="width:40px; height:3px; background:#f59e0b; border-radius:2px;"></div>
              <span>0.0 â€“ 0.3 â†’ Weakly related</span>
            </div>
            <div style="display:flex; align-items:center; gap:10px;">
              <div style="width:40px; height:3px; background:#ef4444; border-radius:2px;"></div>
              <span>âˆ’1.0 â€“ 0.0 â†’ Dissimilar</span>
            </div>
            <div class="formula-box" style="margin-top:6px;">
              sim(A, B) = (A Â· B) / (|A| Ã— |B|)
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PANEL: NEIGHBORS -->
  <div class="panel" id="panel-neighbors">
    <div class="card">
      <div class="card-title">Nearest Neighbors</div>
      <p style="font-size:11px; color:var(--muted); margin-bottom:16px; line-height:1.8;">
        Words closest in embedding space â€” i.e. words that appear in similar contexts.
        Switch epochs above to watch neighbors stabilize as the model trains.
      </p>
      <div class="input-group">
        <div class="input-wrap">
          <label class="input-label">Query Word</label>
          <input type="text" id="nn-word" placeholder="music" value="music"/>
        </div>
        <div class="input-wrap" style="max-width:110px;">
          <label class="input-label">Top K</label>
          <input type="text" id="nn-k" placeholder="10" value="10"/>
        </div>
        <button class="btn" onclick="computeNeighbors()">Search</button>
      </div>
      <div class="suggest-row">
        <span style="font-size:9px;color:var(--muted);letter-spacing:0.1em;text-transform:uppercase;margin-right:4px;">Try:</span>
        <button class="suggest-btn" onclick="setNN('king')">king</button>
        <button class="suggest-btn" onclick="setNN('music')">music</button>
        <button class="suggest-btn" onclick="setNN('war')">war</button>
        <button class="suggest-btn" onclick="setNN('game')">game</button>
        <button class="suggest-btn" onclick="setNN('london')">london</button>
        <button class="suggest-btn" onclick="setNN('science')">science</button>
      </div>
      <div id="nn-error" class="error-msg"></div>
    </div>
    <div class="card" id="nn-result-card" style="display:none">
      <div class="card-title" id="nn-result-title">Neighbors</div>
      <div id="nn-result"></div>
    </div>
  </div>

  <!-- PANEL: ANALOGY -->
  <div class="panel" id="panel-analogy">
    <div class="card">
      <div class="card-title">Vector Arithmetic Â· Analogy Reasoning</div>
      <p style="font-size:11px; color:var(--muted); margin-bottom:16px; line-height:1.8;">
        Solve <strong>A âˆ’ B + C = ?</strong>. Word relationships are encoded as directions in embedding space.
        With more training epochs, the model's analogical reasoning becomes more accurate.
      </p>
      <div class="equation" id="analogy-eq">
        <div class="eq-word" style="background:rgba(79,156,249,0.1);border:1px solid var(--accent);" id="eq-a">king</div>
        <div class="eq-op">âˆ’</div>
        <div class="eq-word" style="background:rgba(124,58,237,0.1);border:1px solid var(--accent2);" id="eq-b">man</div>
        <div class="eq-op">+</div>
        <div class="eq-word" style="background:rgba(16,185,129,0.1);border:1px solid var(--accent3);" id="eq-c">woman</div>
        <div class="eq-op">â‰ˆ</div>
        <div class="eq-word" style="background:rgba(245,158,11,0.1);border:1px solid var(--accent4);" id="eq-result">?</div>
      </div>
      <div class="input-group">
        <div class="input-wrap">
          <label class="input-label" style="color:var(--accent);">Word A</label>
          <input type="text" id="an-a" placeholder="king" value="king" oninput="updateEqDisplay()"/>
        </div>
        <div class="input-wrap">
          <label class="input-label" style="color:var(--accent2);">Word B (subtract)</label>
          <input type="text" id="an-b" placeholder="man" value="man" oninput="updateEqDisplay()"/>
        </div>
        <div class="input-wrap">
          <label class="input-label" style="color:var(--accent3);">Word C (add)</label>
          <input type="text" id="an-c" placeholder="woman" value="woman" oninput="updateEqDisplay()"/>
        </div>
        <button class="btn" onclick="computeAnalogy()">Solve</button>
      </div>
      <div class="suggest-row">
        <span style="font-size:9px;color:var(--muted);letter-spacing:0.1em;text-transform:uppercase;margin-right:4px;">Try:</span>
        <button class="suggest-btn" onclick="setAnalogy('king','man','woman')">kingâˆ’man+woman</button>
        <button class="suggest-btn" onclick="setAnalogy('paris','france','england')">parisâˆ’france+england</button>
        <button class="suggest-btn" onclick="setAnalogy('soldier','war','game')">soldierâˆ’war+game</button>
      </div>
      <div id="an-error" class="error-msg"></div>
    </div>
    <div class="card" id="an-result-card" style="display:none">
      <div class="card-title">Top Predictions</div>
      <div id="an-result"></div>
    </div>
  </div>

  <!-- PANEL: CONCEPTS -->
  <div class="panel" id="panel-concepts">
    <div class="concept-grid">
      <div class="concept-card">
        <div class="concept-icon">ğŸ“–</div>
        <div class="concept-title">What are Embeddings?</div>
        <div class="concept-desc">Each word maps to a dense vector of real numbers. Words with similar meanings or usage patterns end up with similar vectors â€” proximity in vector space = semantic relatedness.</div>
        <div class="formula-box">word â†’ [0.23, âˆ’0.87, ..., 0.64]  âˆˆ â„Â¹â°â°</div>
      </div>
      <div class="concept-card">
        <div class="concept-icon">ğŸªŸ</div>
        <div class="concept-title">Skip-Gram Model</div>
        <div class="concept-desc">Given a center word, predict surrounding context words within a sliding window of size k. This forces the model to learn which words share similar neighborhoods.</div>
        <div class="formula-box">center: "music" â†’ predict:<br/>"album", "guitar", "song", "lyrics"</div>
      </div>
      <div class="concept-card">
        <div class="concept-icon">ğŸ¯</div>
        <div class="concept-title">Negative Sampling</div>
        <div class="concept-desc">Instead of softmax over the full vocabulary, update only the true context word (positive) and k randomly sampled "noise" words (negatives).</div>
        <div class="formula-box">L = log Ïƒ(v_c Â· v_pos) + Î£â‚– log Ïƒ(âˆ’v_c Â· v_neg)<br/><span style="color:var(--muted);">P(neg) âˆ f(w)^0.75</span></div>
      </div>
      <div class="concept-card">
        <div class="concept-icon">ğŸ”½</div>
        <div class="concept-title">Frequency Subsampling</div>
        <div class="concept-desc">Common words like "the" are randomly dropped during training to prevent them from dominating the signal.</div>
        <div class="formula-box">P_discard(w) = max(0, 1 âˆ’ âˆš(t / f(w)))<br/><span style="color:var(--muted);">t = 10â»âµ</span></div>
      </div>
      <div class="concept-card">
        <div class="concept-icon">ğŸ“</div>
        <div class="concept-title">Cosine Similarity</div>
        <div class="concept-desc">The cosine of the angle between two vectors â€” scale-invariant, only direction matters. Range: [âˆ’1, +1].</div>
        <div class="formula-box">sim(A, B) = (A Â· B) / (|A| |B|)</div>
      </div>
      <div class="concept-card">
        <div class="concept-icon">ğŸ§®</div>
        <div class="concept-title">Vector Arithmetic</div>
        <div class="concept-desc">Relationships are encoded as directions, so you can do arithmetic on meaning. Classic example from Mikolov et al. 2013:</div>
        <div class="formula-box">vec("king") âˆ’ vec("man") + vec("woman")<br/>â‰ˆ vec("queen")</div>
      </div>
    </div>
    <div class="card">
      <div class="card-title">Your Training Pipeline</div>
      <div style="font-size:11px; color:var(--muted); line-height:2.1;">
        <strong style="color:var(--text);">1. Dataset</strong>: WikiText-2 (train + val + test concatenated, ~2M tokens)<br/>
        <strong style="color:var(--text);">2. Cleaning</strong>: Remove headings (= markers), lowercase, replace hyphens<br/>
        <strong style="color:var(--text);">3. Tokenization</strong>: Whitespace split â†’ build Counter vocabulary<br/>
        <strong style="color:var(--text);">4. Frequency filter</strong>: Drop words appearing &lt; 5 times<br/>
        <strong style="color:var(--text);">5. Subsampling</strong>: Randomly discard frequent words with P_discard(w)<br/>
        <strong style="color:var(--text);">6. Pair generation</strong>: Sliding window (size=3) â†’ (center, context) pairs<br/>
        <strong style="color:var(--text);">7. Negative sampling</strong>: k=5 negatives per pair, sampled âˆ f(w)^0.75<br/>
        <strong style="color:var(--text);">8. Model</strong>: SkipGram with separate input / output nn.Embedding tables<br/>
        <strong style="color:var(--text);">9. Training</strong>: Adam, lr=0.001, batch_size=256, embed_dim=100<br/>
        <strong style="color:var(--text);">10. Checkpoints</strong>: Model saved at epoch 2, 5, 10 â†’ exported to JSON
      </div>
    </div>
  </div>

</div>

<div class="footer">
  Built to accompany a Word2Vec Skip-Gram implementation on WikiText-2 Â·
  <a href="https://arxiv.org/abs/1301.3781" target="_blank">Mikolov et al. 2013</a> Â·
  Switch epochs to watch the model learn
</div>

<!-- ============================================================
     JAVASCRIPT
     ============================================================ -->
<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const EPOCH_FILES = {
  2:  'embeddings_epoch2.json',
  5:  'embeddings_epoch5.json',
  10: 'embeddings_epoch10.json',
};

const EPOCH_PROGRESS = { 2: '20%', 5: '50%', 10: '100%' };

// All loaded data keyed by epoch
const epochData = {};      // { 2: {words, embeddings, coords_2d, ...}, ... }
let activeEpoch = 10;      // currently displayed epoch
let activeData  = null;    // shortcut to epochData[activeEpoch]

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CATEGORY COLOURS â€” auto-assigned from k-means-like grouping
// We infer categories from word lists after loading
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PALETTE = [
  '#4f9cf9','#f59e0b','#10b981','#c084fc',
  '#fb923c','#ef4444','#38bdf8','#a3e635',
  '#f472b6','#34d399','#60a5fa','#fbbf24',
];

// Optional: hardcode known category seeds for your vocabulary
// The demo will use these to colour-code if words match
const CATEGORY_SEEDS = {
  royalty:   ['king','queen','prince','princess','emperor','monarch','throne','crown','palace','noble'],
  music:     ['music','song','album','guitar','piano','melody','rhythm','lyrics','concert','band'],
  gaming:    ['game','gaming','player','console','level','quest','dungeon','pixel','sprite','arcade'],
  science:   ['science','physics','chemistry','biology','atom','electron','molecule','quantum','gravity','energy'],
  animals:   ['dog','cat','bird','lion','tiger','wolf','bear','eagle','horse','elephant'],
  war:       ['war','battle','soldier','army','weapon','sword','attack','siege','general','victory'],
  geography: ['london','paris','germany','france','england','europe','city','capital','country','island'],
  sports:    ['football','cricket','tennis','basketball','olympic','athlete','match','tournament','champion'],
};

const CAT_LABELS = {
  royalty:'Royalty & Power', music:'Music', gaming:'Gaming',
  science:'Science', animals:'Animals & Nature', war:'War & Conflict',
  geography:'Geography', sports:'Sports', other:'Other',
};

function assignCategory(word) {
  for (const [cat, seeds] of Object.entries(CATEGORY_SEEDS)) {
    if (seeds.includes(word.toLowerCase())) return cat;
  }
  return 'other';
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// COSINE (vectors are already L2-normalised by export script)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function cosine(a, b) {
  let dot = 0;
  for (let i = 0; i < a.length; i++) dot += a[i] * b[i];
  return Math.max(-1, Math.min(1, dot));
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// LOADING
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadEpoch(ep) {
  if (epochData[ep]) return true;   // already loaded

  const fname = EPOCH_FILES[ep];
  try {
    const res = await fetch(fname);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    epochData[ep] = data;
    return true;
  } catch (e) {
    console.warn(`Could not load ${fname}:`, e);
    return false;
  }
}

async function loadAllEpochs() {
  setLoading(true, 'Loading epoch embeddingsâ€¦');

  let anyFailed = false;
  for (const ep of [2, 5, 10]) {
    setLoading(true, `Loading embeddings_epoch${ep}.jsonâ€¦`);
    const ok = await loadEpoch(ep);
    if (!ok) {
      anyFailed = true;
      console.warn(`Falling back to mock data for epoch ${ep}`);
      epochData[ep] = generateMockData(ep);
    }
  }

  if (anyFailed) {
    document.getElementById('error-banner').style.display = 'block';
  }

  activeData = epochData[activeEpoch];
  setLoading(false);
  updateAllUI();
}

function setLoading(on, msg = '') {
  const el = document.getElementById('loading-overlay');
  el.classList.toggle('hidden', !on);
  if (msg) document.getElementById('loading-msg').textContent = msg;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MOCK DATA GENERATOR (fallback if JSON files not present)
// Epoch 2: noisy/scattered, Epoch 5: forming, Epoch 10: tight clusters
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function generateMockData(epoch) {
  const tightness = { 2: 0.7, 5: 0.38, 10: 0.18 }[epoch] || 0.3;

  const CENTERS = {
    royalty:   [0.0,  0.8],
    music:     [-1.4,-0.6],
    gaming:    [1.6,  0.2],
    science:   [0.4, -1.5],
    animals:   [-1.0, 1.2],
    war:       [1.2, -1.2],
    geography: [-0.5,-0.4],
    sports:    [0.9,  1.4],
  };

  const WORD_LISTS = {
    royalty:   ['king','queen','prince','princess','emperor','empress','throne','crown','palace','monarch','royal','dynasty','heir','noble','lord','knight','castle','court','reign','sovereign'],
    music:     ['music','song','album','guitar','piano','melody','rhythm','lyrics','concert','band','singer','composer','jazz','blues','rock','drum','bass','chord','harmony','orchestra'],
    gaming:    ['game','gaming','player','multiplayer','console','level','score','quest','dungeon','pixel','sprite','controller','arcade','loot','achievement','esports','clan','spawn','rpg','fps'],
    science:   ['science','physics','chemistry','biology','atom','electron','molecule','experiment','quantum','gravity','energy','force','lab','data','formula','research','evolution','dna','cell','gene'],
    animals:   ['dog','cat','bird','lion','tiger','wolf','bear','eagle','horse','elephant','forest','nature','tree','river','ocean','whale','fox','deer','rabbit','snake'],
    war:       ['war','battle','soldier','army','weapon','sword','gun','strategy','attack','siege','general','victory','defeat','troop','enemy','rebel','campaign','conquest','artillery','navy'],
    geography: ['london','paris','germany','france','england','europe','city','capital','country','island','mountain','valley','north','south','east','west','border','region','map','coast'],
    sports:    ['football','cricket','tennis','basketball','olympic','athlete','score','match','tournament','champion','stadium','team','coach','league','goal','marathon','sprint','medal','competition','record'],
  };

  let seed = epoch * 1337;
  function sr() {
    seed = (seed * 1664525 + 1013904223) & 0xffffffff;
    return (seed >>> 0) / 0xffffffff;
  }
  function sg() {
    const u = sr() || 1e-10, v = sr() || 1e-10;
    return Math.sqrt(-2*Math.log(u)) * Math.cos(2*Math.PI*v);
  }

  const words = [], embeddings = {}, coords_2d = {};

  for (const [cat, wlist] of Object.entries(WORD_LISTS)) {
    const center100 = Array.from({length:100}, () => sg());
    const cn = Math.sqrt(center100.reduce((s,x)=>s+x*x,0));
    const cc = center100.map(x=>x/cn);

    for (const w of wlist) {
      words.push(w);
      // 2D position
      const px = CENTERS[cat][0] + sg() * tightness;
      const py = CENTERS[cat][1] + sg() * tightness;
      coords_2d[w] = [px, py];
      // 100d embedding
      const emb = cc.map(v => v + sg() * tightness * 2);
      const n = Math.sqrt(emb.reduce((s,x)=>s+x*x,0));
      embeddings[w] = emb.map(x=>x/n);
    }
  }

  return {
    epoch, vocab_size: words.length, embed_dim: 100,
    pca_variance: [0.12, 0.08],
    words, embeddings, coords_2d,
  };
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// EPOCH SWITCHING
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function switchEpoch(ep) {
  if (ep === activeEpoch) return;

  if (!epochData[ep]) {
    setLoading(true, `Loading epoch ${ep} embeddingsâ€¦`);
    const ok = await loadEpoch(ep);
    if (!ok) epochData[ep] = generateMockData(ep);
    setLoading(false);
  }

  activeEpoch = ep;
  activeData  = epochData[ep];

  // Update buttons
  document.querySelectorAll('.epoch-btn').forEach(b => {
    b.classList.toggle('active', parseInt(b.dataset.epoch) === ep);
  });
  document.getElementById('epoch-pill').textContent = `Epoch ${ep}`;
  document.getElementById('learning-bar').style.width = EPOCH_PROGRESS[ep];

  updateAllUI();
}

function updateAllUI() {
  const d = activeData;
  if (!d) return;

  // Stats bar
  document.getElementById('stat-vocab').textContent = d.vocab_size;
  document.getElementById('stat-dim').textContent   = `${d.embed_dim} â†’ 2`;
  document.getElementById('stat-pca').textContent   =
    d.pca_variance ? `${(d.pca_variance[0]*100).toFixed(1)}% + ${(d.pca_variance[1]*100).toFixed(1)}%` : 'â€”';
  document.getElementById('vocab-info').textContent = `${d.vocab_size} words`;

  buildScatter();

  // Re-run active computations
  const activePanel = document.querySelector('.panel.active')?.id;
  if (activePanel === 'panel-similarity') computeSimilarity(true);
  if (activePanel === 'panel-neighbors') computeNeighbors(true);
  if (activePanel === 'panel-analogy') computeAnalogy(true);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SCATTER PLOT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const hiddenCats = new Set();

function buildScatter() {
  if (!activeData) return;
  const { coords_2d } = activeData;

  // Group words by category
  const groups = {};
  for (const word of Object.keys(coords_2d)) {
    const cat = assignCategory(word);
    if (!groups[cat]) groups[cat] = { x:[], y:[], text:[] };
    const pt = coords_2d[word];
    groups[cat].x.push(pt[0]);
    groups[cat].y.push(pt[1]);
    groups[cat].text.push(word);
  }

  const catList = Object.keys(groups);
  const traces  = catList.map((cat, i) => ({
    x: groups[cat].x, y: groups[cat].y, text: groups[cat].text,
    mode: 'markers+text', textposition: 'top center',
    textfont: { size:8, color: PALETTE[i % PALETTE.length] },
    marker: { size:6, color: PALETTE[i % PALETTE.length], opacity:0.85,
              line:{ width:1, color:'rgba(0,0,0,0.3)' } },
    name: CAT_LABELS[cat] || cat,
    visible: hiddenCats.has(cat) ? 'legendonly' : true,
    hovertemplate: '<b>%{text}</b><extra></extra>',
  }));

  const layout = {
    paper_bgcolor: '#070b14', plot_bgcolor: '#070b14',
    font: { family:'DM Mono, monospace', color:'#64748b', size:9 },
    xaxis: { title:'PCA Component 1', gridcolor:'#1e2f4a', zerolinecolor:'#1e2f4a', tickfont:{size:8} },
    yaxis: { title:'PCA Component 2', gridcolor:'#1e2f4a', zerolinecolor:'#1e2f4a', tickfont:{size:8} },
    legend: { bgcolor:'rgba(13,20,36,0.85)', bordercolor:'#1e2f4a', borderwidth:1, font:{size:9} },
    margin: {l:50,r:20,t:14,b:50}, hovermode:'closest',
    annotations: [{
      xref:'paper', yref:'paper', x:0.5, y:1.02,
      text:`Epoch ${activeEpoch} Â· ${activeData.vocab_size} words`,
      showarrow:false, font:{size:10, color:'#4f9cf9'}, xanchor:'center',
    }],
  };

  Plotly.react('scatter-plot', traces, layout, {responsive:true, displayModeBar:false});

  // Rebuild legend
  const legendEl = document.getElementById('legend');
  legendEl.innerHTML = '';
  catList.forEach((cat, i) => {
    const item = document.createElement('div');
    item.className = 'legend-item' + (hiddenCats.has(cat) ? '' : ' active');
    item.dataset.cat = cat;
    item.innerHTML = `<div class="legend-dot" style="background:${PALETTE[i%PALETTE.length]}"></div><span>${CAT_LABELS[cat]||cat}</span>`;
    item.onclick = () => {
      const traceIdx = catList.indexOf(cat);
      if (hiddenCats.has(cat)) {
        hiddenCats.delete(cat);
        Plotly.restyle('scatter-plot', {visible:true}, [traceIdx]);
        item.classList.add('active');
      } else {
        hiddenCats.add(cat);
        Plotly.restyle('scatter-plot', {visible:'legendonly'}, [traceIdx]);
        item.classList.remove('active');
      }
    };
    legendEl.appendChild(item);
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SIMILARITY
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function computeSimilarity(silent = false) {
  if (!activeData) return;
  const w1 = document.getElementById('sim-word1').value.trim().toLowerCase();
  const w2 = document.getElementById('sim-word2').value.trim().toLowerCase();
  const errEl = document.getElementById('sim-error');
  errEl.textContent = '';

  if (!activeData.embeddings[w1] || !activeData.embeddings[w2]) {
    if (!silent) {
      const miss = [w1,w2].filter(w => !activeData.embeddings[w]);
      errEl.textContent = `Not in vocabulary: ${miss.join(', ')}`;
    }
    return;
  }

  const score = cosine(activeData.embeddings[w1], activeData.embeddings[w2]);
  let barColor = '#ef4444', label = 'Dissimilar';
  if (score > 0.7)      { barColor = '#10b981'; label = 'Strongly related'; }
  else if (score > 0.3) { barColor = '#4f9cf9'; label = 'Moderately related'; }
  else if (score > 0)   { barColor = '#f59e0b'; label = 'Weakly related'; }

  document.getElementById('sim-result').innerHTML = `
    <div style="display:flex; align-items:baseline; gap:14px; margin-bottom:6px;">
      <div class="score-large" style="color:${barColor}">${score.toFixed(4)}</div>
      <div>
        <div style="font-size:13px; color:${barColor};">${label}</div>
        <div class="score-label">${w1} â†” ${w2} Â· Epoch ${activeEpoch}</div>
      </div>
    </div>
    <div class="score-bar-wrap">
      <div class="score-bar" id="sbar" style="width:0%; background:${barColor}"></div>
    </div>
    <div style="display:flex; justify-content:space-between; font-size:9px; color:var(--muted);">
      <span>âˆ’1.0</span><span>0</span><span>+1.0</span>
    </div>`;

  setTimeout(() => {
    const el = document.getElementById('sbar');
    if (el) el.style.width = `${((score+1)/2*100).toFixed(1)}%`;
  }, 50);

  // Cross-epoch comparison
  const epochs = [2, 5, 10];
  let compareHTML = '<div class="epoch-compare-row">';
  epochs.forEach(ep => {
    const d = epochData[ep];
    if (!d || !d.embeddings[w1] || !d.embeddings[w2]) return;
    const s = cosine(d.embeddings[w1], d.embeddings[w2]);
    const pct = ((s+1)/2*100).toFixed(1);
    let col = '#ef4444';
    if (s > 0.7) col = '#10b981';
    else if (s > 0.3) col = '#4f9cf9';
    else if (s > 0) col = '#f59e0b';
    const isCurrent = ep === activeEpoch;
    compareHTML += `
      <div class="epoch-compare-item">
        <div class="ecl" style="${isCurrent ? 'color:var(--accent)' : ''}">Epoch ${ep}</div>
        <div class="ecbar-wrap">
          <div class="ecbar" style="width:${pct}%; background:${col};"></div>
        </div>
        <div class="ecval">${s.toFixed(3)}</div>
        ${isCurrent ? '<span style="font-size:9px;color:var(--accent);margin-left:4px;">â—€ current</span>' : ''}
      </div>`;
  });
  compareHTML += '</div><p style="font-size:10px;color:var(--muted);margin-top:10px;">As training progresses, related words should show <em>increasing</em> similarity.</p>';
  document.getElementById('epoch-compare-result').innerHTML = compareHTML;
}

function setSim(a, b) {
  document.getElementById('sim-word1').value = a;
  document.getElementById('sim-word2').value = b;
  computeSimilarity();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// NEIGHBORS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function computeNeighbors(silent = false) {
  if (!activeData) return;
  const word = document.getElementById('nn-word').value.trim().toLowerCase();
  const k    = Math.min(parseInt(document.getElementById('nn-k').value) || 10, 50);
  const errEl = document.getElementById('nn-error');
  errEl.textContent = '';

  if (!activeData.embeddings[word]) {
    if (!silent) errEl.textContent = `"${word}" not in vocabulary.`;
    return;
  }

  const scores = Object.entries(activeData.embeddings)
    .filter(([w]) => w !== word)
    .map(([w, emb]) => [w, cosine(activeData.embeddings[word], emb)])
    .sort((a,b) => b[1]-a[1])
    .slice(0, k);

  const card  = document.getElementById('nn-result-card');
  card.style.display = 'block';
  document.getElementById('nn-result-title').textContent =
    `Top ${k} neighbors of "${word}" â€” Epoch ${activeEpoch}`;

  let html = '<div style="display:flex; flex-direction:column; gap:7px;">';
  scores.forEach(([w, score], i) => {
    const cat   = assignCategory(w);
    const catIdx = Object.keys(CATEGORY_SEEDS).indexOf(cat);
    const color  = PALETTE[catIdx >= 0 ? catIdx : 8];
    const pct    = ((score+1)/2*100).toFixed(1);
    html += `
      <div style="display:flex; align-items:center; gap:10px;">
        <span style="font-size:9px; color:var(--muted); width:18px; text-align:right;">${i+1}</span>
        <span style="width:110px; font-size:12px; color:${color}; cursor:pointer;"
              onclick="setNN('${w}')">${w}</span>
        <div style="flex:1; height:3px; background:var(--border); border-radius:2px; overflow:hidden;">
          <div style="width:${pct}%; height:100%; background:${color}; border-radius:2px;
                      transition:width 0.5s ease ${i*0.03}s;"></div>
        </div>
        <span style="font-size:10px; color:var(--muted); width:46px; text-align:right;">${score.toFixed(3)}</span>
      </div>`;
  });
  html += '</div>';
  document.getElementById('nn-result').innerHTML = html;
}

function setNN(word) {
  document.getElementById('nn-word').value = word;
  switchTab('neighbors');
  computeNeighbors();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ANALOGY
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateEqDisplay() {
  document.getElementById('eq-a').textContent = document.getElementById('an-a').value || 'A';
  document.getElementById('eq-b').textContent = document.getElementById('an-b').value || 'B';
  document.getElementById('eq-c').textContent = document.getElementById('an-c').value || 'C';
  document.getElementById('eq-result').textContent = '?';
}

function computeAnalogy(silent = false) {
  if (!activeData) return;
  const a = document.getElementById('an-a').value.trim().toLowerCase();
  const b = document.getElementById('an-b').value.trim().toLowerCase();
  const c = document.getElementById('an-c').value.trim().toLowerCase();
  const errEl = document.getElementById('an-error');
  errEl.textContent = '';

  const embs = activeData.embeddings;
  const missing = [a,b,c].filter(w => !embs[w]);
  if (missing.length) {
    if (!silent) errEl.textContent = `Not in vocabulary: ${missing.join(', ')}`;
    return;
  }

  const target = embs[a].map((v,i) => v - embs[b][i] + embs[c][i]);
  const tn = Math.sqrt(target.reduce((s,x)=>s+x*x,0));
  const tN = target.map(x=>x/tn);

  const exclude = new Set([a,b,c]);
  const scores = Object.entries(embs)
    .filter(([w]) => !exclude.has(w))
    .map(([w, emb]) => [w, cosine(emb, tN)])
    .sort((x,y) => y[1]-x[1])
    .slice(0, 5);

  document.getElementById('eq-result').textContent = scores[0]?.[0] || '?';

  const card = document.getElementById('an-result-card');
  card.style.display = 'block';

  let html = `<p style="font-size:11px; color:var(--muted); margin-bottom:14px;">
    <em>${a}</em> is to <em>${b}</em> as <em>${c}</em> is toâ€¦ (Epoch ${activeEpoch})</p>
    <div style="display:flex; flex-direction:column; gap:9px;">`;

  scores.forEach(([w, score], i) => {
    const catIdx = Object.keys(CATEGORY_SEEDS).indexOf(assignCategory(w));
    const color  = PALETTE[catIdx >= 0 ? catIdx : 8];
    const size   = i === 0 ? '1.35rem' : '0.9rem';
    const ff     = i === 0 ? "'Fraunces', serif" : "'DM Mono', monospace";
    const fw     = i === 0 ? '700' : '400';
    html += `
      <div style="display:flex; align-items:center; gap:10px;">
        <span style="font-size:9px; color:var(--muted); width:18px; text-align:right;">${i+1}</span>
        <span style="font-size:${size}; font-family:${ff}; font-weight:${fw}; color:${color}; width:130px;">${w}</span>
        <div style="flex:1; height:3px; background:var(--border); border-radius:2px; overflow:hidden;">
          <div style="width:${(score*100).toFixed(1)}%; height:100%; background:${color}; border-radius:2px;
                      transition:width 0.5s ease ${i*0.05}s;"></div>
        </div>
        <span style="font-size:10px; color:var(--muted);">${score.toFixed(3)}</span>
      </div>`;
  });
  html += '</div>';
  document.getElementById('an-result').innerHTML = html;
}

function setAnalogy(a,b,c) {
  document.getElementById('an-a').value = a;
  document.getElementById('an-b').value = b;
  document.getElementById('an-c').value = c;
  updateEqDisplay();
  switchTab('analogy');
  computeAnalogy();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TAB SWITCHING
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchTab(name) {
  const names = ['explore','similarity','neighbors','analogy','concepts'];
  document.querySelectorAll('.tab').forEach((t,i) =>
    t.classList.toggle('active', names[i] === name));
  document.querySelectorAll('.panel').forEach(p =>
    p.classList.toggle('active', p.id === `panel-${name}`));
}

// Enter key support
document.addEventListener('keydown', e => {
  if (e.key !== 'Enter') return;
  const id = document.querySelector('.panel.active')?.id;
  if (id === 'panel-similarity') computeSimilarity();
  if (id === 'panel-neighbors')  computeNeighbors();
  if (id === 'panel-analogy')    computeAnalogy();
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// BOOT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
loadAllEpochs();
</script>
</body>
</html>
